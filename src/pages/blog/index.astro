---
/**
 * Blog Listing Page
 *
 * Displays all blog posts with filtering by category.
 * Uses Astro content collections for blog posts.
 */

import { getCollection } from 'astro:content';
import InnerLayout from '../../layouts/InnerLayout.astro';
import BlogCard from '../../components/library/BlogCard.astro';

// Get all blog posts from content collection
const allBlogPosts = await getCollection('blog');

// Sort by date (newest first) and format for display
const blogPosts = allBlogPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .map(post => {
    const formattedDate = new Intl.DateTimeFormat('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
    }).format(post.data.date);

    return {
      title: post.data.title,
      excerpt: post.data.description,
      featuredImage: post.data.featuredImage,
      slug: post.slug,
      category: post.data.category,
      author: post.data.author,
      authorImage: post.data.authorImage,
      date: formattedDate,
      readingTime: post.data.readingTime,
    };
  });

// Get unique categories for filtering
const categories = ['All', ...new Set(blogPosts.map(post => post.category))];
---

<InnerLayout
  title="Blog"
  description="Articles about web development, design, and technology. Learn Astro, Tailwind CSS, accessibility best practices, and modern web development techniques."
  ogImage="https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=1200&h=630&fit=crop"
  pageTitle="Our Blog"
  pageSubtitle="Insights, tutorials, and best practices for modern web development"
  containerized={false}
>
  <!-- Category Filter -->
  <div class="bg-white border-b border-neutral-200">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="flex flex-wrap gap-3 justify-center">
        {categories.map((category) => (
          <button
            class="category-filter px-5 py-2 rounded-full font-medium transition-all
              {category === 'All' ? 'bg-primary-600 text-white' : 'bg-neutral-100 text-neutral-700 hover:bg-neutral-200'}"
            data-category={category}
          >
            {category}
          </button>
        ))}
      </div>
    </div>
  </div>

  <!-- Blog Grid -->
  <section class="py-12 md:py-16 bg-neutral-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div id="blog-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {blogPosts.map((post) => (
          <div class="blog-post-item" data-category={post.category}>
            <BlogCard {...post} />
          </div>
        ))}
      </div>

      <!-- No Results Message -->
      <div id="no-results" class="hidden text-center py-12">
        <div class="text-6xl mb-4">üìù</div>
        <h3 class="text-2xl font-bold text-neutral-900 mb-2">No posts found</h3>
        <p class="text-neutral-600">Try selecting a different category</p>
      </div>
    </div>
  </section>
</InnerLayout>

<script>
  // Category filtering
  const filterButtons = document.querySelectorAll('.category-filter');
  const blogItems = document.querySelectorAll('.blog-post-item');
  const noResults = document.getElementById('no-results');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const category = button.getAttribute('data-category');

      // Update active button
      filterButtons.forEach(btn => {
        btn.classList.remove('bg-primary-600', 'text-white');
        btn.classList.add('bg-neutral-100', 'text-neutral-700', 'hover:bg-neutral-200');
      });
      button.classList.remove('bg-neutral-100', 'text-neutral-700', 'hover:bg-neutral-200');
      button.classList.add('bg-primary-600', 'text-white');

      // Filter posts
      let visibleCount = 0;
      blogItems.forEach(item => {
        const itemCategory = item.getAttribute('data-category');
        if (category === 'All' || itemCategory === category) {
          item.classList.remove('hidden');
          visibleCount++;
        } else {
          item.classList.add('hidden');
        }
      });

      // Show/hide no results message
      if (visibleCount === 0) {
        noResults?.classList.remove('hidden');
      } else {
        noResults?.classList.add('hidden');
      }
    });
  });
</script>
