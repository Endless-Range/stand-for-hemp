---
/**
 * Dynamic Blog Post Page
 *
 * Renders individual blog posts from the content collection.
 * Uses Astro's content collections for markdown support.
 */

import { getCollection } from 'astro:content';
import LandingLayout from '../../layouts/LandingLayout.astro';
import Navigation from '../../components/Navigation.astro';

export const prerender = true;

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog', ({ data }) => {
    return !data.draft;
  });
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;

// Safety check
if (!entry) {
  throw new Error('Blog entry not found');
}

const { Content } = await entry.render();

// Format the date
const formattedDate = new Intl.DateTimeFormat('en-US', {
  month: 'long',
  day: 'numeric',
  year: 'numeric',
}).format(entry.data.date);
---

<LandingLayout
  title={entry.data.title}
  description={entry.data.description}
  ogImage={entry.data.featuredImage || '/og-image.png'}
>
  <Navigation />

  <!-- Hero Section -->
  <section class="py-16 md:py-24 bg-gradient-to-br from-[var(--color-hemp-green)] to-[var(--color-soil-dark)]">
    <div class="container mx-auto px-6 max-w-4xl">
      <h1 class="text-4xl md:text-6xl font-bold text-white mb-6">
        {entry.data.title}
      </h1>
      <div class="flex items-center gap-4 text-white/80 text-lg">
        <span>{formattedDate}</span>
        {entry.data.readingTime && (
          <>
            <span>•</span>
            <span>{entry.data.readingTime} min read</span>
          </>
        )}
        {entry.data.author && (
          <>
            <span>•</span>
            <span>By {entry.data.author}</span>
          </>
        )}
      </div>
    </div>
  </section>

  <!-- Blog Content -->
  <article class="py-16 md:py-24" style="background-color: var(--color-soft-cream);">
    <div class="container mx-auto px-6 max-w-4xl">
      {entry.data.featuredImage && (
        <img
          src={entry.data.featuredImage}
          alt={entry.data.title}
          class="w-full h-96 object-cover rounded-lg mb-12"
        />
      )}
      <div class="prose prose-xl max-w-none">
        <Content />
      </div>

      <!-- Back to Blog Link -->
      <div class="mt-12 pt-8 border-t border-neutral-300">
        <a
          href="/blog/"
          class="inline-flex items-center gap-2 text-lg font-semibold hover:underline transition-colors"
          style="color: var(--color-hemp-green);"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Blog
        </a>
      </div>
    </div>
  </article>

  <!-- CTA Section -->
  <section class="py-20 md:py-32 text-center" style="background-color: var(--color-sky-blue);">
    <div class="container mx-auto px-6 max-w-4xl">
      <h2 class="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight">
        Ready to Take Action?
      </h2>
      <p class="text-xl md:text-2xl text-white/90 mb-10 max-w-content mx-auto">
        Contact your representatives in 60 seconds and help save American hemp
      </p>

      <a
        href="/take-action"
        class="inline-block px-10 py-4 text-xl font-bold rounded-lg transition-all hover:transform hover:-translate-y-0.5 hover:shadow-lg bg-white text-[var(--color-hemp-green)] hover:bg-[var(--color-wheat-gold)]"
      >
        Take Action Now →
      </a>
    </div>
  </section>
</LandingLayout>

<style>
  .prose {
    color: var(--color-soil-dark);
  }

  .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
    color: var(--color-hemp-green);
    font-weight: bold;
    margin-top: 2em;
    margin-bottom: 1em;
  }

  .prose p {
    margin-bottom: 1.5em;
    line-height: 1.8;
  }

  .prose a {
    color: var(--color-hemp-green);
    text-decoration: underline;
  }

  .prose a:hover {
    color: var(--color-soil-dark);
  }

  .prose ul, .prose ol {
    margin-bottom: 1.5em;
    padding-left: 2em;
  }

  .prose li {
    margin-bottom: 0.5em;
  }

  .prose strong {
    color: var(--color-soil-dark);
    font-weight: 600;
  }

  .prose img {
    border-radius: 0.5rem;
    margin: 2em 0;
  }

  .prose blockquote {
    border-left: 4px solid var(--color-hemp-green);
    padding-left: 1.5em;
    font-style: italic;
    color: var(--color-soil-dark);
    opacity: 0.9;
  }
</style>
